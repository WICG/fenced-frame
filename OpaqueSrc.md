# Fenced frames opaque source


# Introduction

For certain use cases the document rendered inside a fenced frame needs to be hidden from the embedding context. These are scenarios like [interest based ads](https://github.com/WICG/turtledove) where the embedding page cannot know which ad won the auction so that the user’s interest groups are not made known to the sites they visit. This document proposes a web-platform way of providing the src input to the fenced frame while guaranteeing that the embedding page cannot enquire and know the ad being rendered.


# Proposed solution

The fenced frame’s src can be a [urn:uuid](https://tools.ietf.org/html/rfc4122) when generated by browser APIs like Turtledove and it maps to an actual ad url either downloaded as a web bundle or that needs to be retrieved from the network (for the initial version). Browser APIs are responsible for:



1. Mapping of a urn:uuid to an actual ad url 
2. Making sure that the urn:uuid is not deterministic or known to the JS environment executing ad-tech provided JS. This is to make sure that the bits in the URN are not used to convey information back to the embedding page.
3. Returning the urn:uuid to the calling JS which can then use it to create a fenced frame.
4. The browser is responsible for mapping the fenced frame src to an actual ad and rendering it.


## Turtledove Example

When the SSP JS invokes the Turtledove API to run the ad auction, it gets back the URN as the result, which is then used for rendering the fenced frame. This URN maps to an actual ad url which is part of the interest group. Note that the URN value is not part of the interest groups and not available to the bidding/auction worklets but is created in an undetermisnistic manner by the Turtledove API when returning the winning ad back to the invoking JS.


```js
navigator.runAdAuction(myAuctionConfig).then((auctionWinnerUrl) => {
  // auctionWinnerUrl value e.g.
  // urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
  var adFrame = document.createElement('fencedframe');
  adFrame.setAttribute(src,auctionWinnerUrl);
});
```



# Prior Art 

https://github.com/WICG/webpackage/blob/master/explainers/subresource-loading.md goes into how a urn::uuid identified resource inside a web bundle is used to create an iframe with an opaque origin.
